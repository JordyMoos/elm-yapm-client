<!DOCTYPE html>
<html lang="en" manifest="manifest.appcache">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Passwords</title>
    <link rel="icon" type="image/png" href="img/favicon.png" />

    <!-- build:js js/manager.min.js -->
    <script src="js/manager.js" type="application/javascript;version=1.8"></script>
    <!-- /build -->
    <!-- build:js js/elm.min.js -->
    <script src="js/elm.js" type="application/javascript"></script>
    <!-- /build -->

    <!-- build:css css/tidy.css -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/yapm.css" />
    <!-- /build -->

</head>

<body>
    <div id="main"></div>
    <script>
      var app = Elm.Main.fullscreen();
      app.ports.parseLibraryData.subscribe(function (request) {
        console.log('In parse library data');
        console.log(arguments);

        var promise = window.yapm.createCryptoManager(
          request.masterKey,
          request.libraryData
        );
        console.log(promise);

        promise.getPasswordList()
          .then(function (passwordList) {
            console.log('Get password list then');
            console.log(arguments);
            console.log(passwordList);
          })
          .catch(function (error) {
            var errorMsg = 'Unknown error';
            if (typeof(error) === 'string') {
              errorMsg = error;
            } else if (typeof(error) === 'object') {
              if (error.message && typeof(error.message) === 'string') {
                errorMsg = error.message;
              }
            }
            console.log('Get password list catch');
            console.log(arguments);
            console.log('Error: ' + errorMsg);

            app.ports.error.send(errorMsg);
          });
      });
    </script>
</body>

</html>
