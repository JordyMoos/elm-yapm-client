<!DOCTYPE html>
<html lang="en" manifest="manifest.appcache">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Passwords</title>
    <link rel="icon" type="image/png" href="img/favicon.png" />

    <!-- build:js js/manager.min.js -->
    <script src="js/manager.js" type="application/javascript;version=1.8"></script>
    <!-- /build -->
    <!-- build:js js/elm.min.js -->
    <script src="js/elm.js" type="application/javascript"></script>
    <!-- /build -->

    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/yapm.css" />

</head>

<body>
    <script>
      function getErrorMessage(error) {
        console.log('In catch');
        console.log(error);

        if (typeof(error) === 'string') {
          return error;
        }

        if (typeof(error) === 'object') {
          if (error.message && typeof(error.message) === 'string') {
            return error.message;
          }
        }

        return 'Unknown error';
      }

      var app = Elm.Main.fullscreen(window.yapm.config);
      app.ports.parseLibraryData.subscribe(function (request) {
        window.yapm.decryptLibrary(request)
          .then(function (passwords) {
            app.ports.passwords.send(passwords);
          })
          .catch(function (error) {
            app.ports.error.send(getErrorMessage(error));
          });
      });

      app.ports.encryptLibraryData.subscribe(function (request) {
        window.yapm.encryptLibrary(request)
          .then(function (data) {
            app.ports.uploadLibrary.send({
              oldHash: data[0],
              libraryData: data[1],
              newHash: data[2]
            });
          })
          .catch(function (error) {
            app.ports.error.send(getErrorMessage(error));
          });
      });
    </script>
</body>

</html>
